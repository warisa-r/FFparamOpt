# Find minimum energy fcc configuration

# ---------- Initialize Simulation --------------------- 
clear 
units real
dimension 3 
boundary p p p  # Setting all boundaries to "s" (shrink-wrapped)
atom_style charge
atom_modify map array

# ---------- Create Atoms ---------------------
# Define supercell parameters
variable nx equal 2
variable ny equal 2
variable nz equal 2
variable total_cells equal ${nx}*${ny}*${nz}

region box block 0 ${nx} 0 ${ny} 0 ${nz}

# Data from https://materials.springer.com/isp/crystallographic/docs/sd_1923902
# use atomsk 'ceo2_structure.cif lammps' to convert the file
read_data C:\Users\user\Documents\School\FFparamOpt\reax_ff_sim\ceo2_reaxff\geometry_file\ceO2_fluorite.lmp
group Ce type 1

# ---------- Define Interatomic Potential ---------------------
pair_style reaxff NULL checkqeq yes # Enable charge equilibration (QEq)
pair_coeff * * C:\Users\user\Documents\School\FFparamOpt\reax_ff_sim\ffield.reax O Ce
fix qeq all qeq/reaxff 1 0.0 10.0 1.0e-6 reaxff
neighbor 2.0 bin 
neigh_modify delay 10000 check yes

# ---------- Set Temperature to 0K ---------------------
velocity all create 0.0 12345 mom yes rot yes
 
# ---------- Define Settings --------------------- 
compute eng all pe/atom 
compute eatoms all reduce sum c_eng 

# ---------- Add Electric Field ---------------------
# Apply force to all atoms in the direction of the electric field
#fix efield all efield 5.0 0.0 0.0 region box

# ---------- Run Minimization --------------------- 
reset_timestep 0 
# fix 1 all box/relax iso 1.0 vmax 5
thermo 10
thermo_style custom step pe lx ly lz press pxx pyy pzz c_eatoms 
#dump mydmp all atom 1 dump_efield.lammpstrj
min_style cg 
minimize 1e-25 1e-25 5000 10000

variable natoms equal "count(all)" 
variable teng equal pe
variable length equal "lx"
variable ecoh equal "v_teng/v_natoms"
variable v_vol equal vol

# Calculate the number of Cerium atoms
variable nCe equal "count(Ce)"

# Calculate lattice parameter a (assuming cubic lattice)
variable a0 equal "lx"

# Calculate lattice parameter c (for non-cubic systems, e.g., hexagonal)
variable c0 equal "lz"

# Conversion factor from kcal/mol to eV
variable conv equal 0.0433641

# Calculate the energy per Cerium atom in eV
variable energy_eV equal ${teng}*${conv} #eV/atom

# Calculate the energy per Cerium atom
variable energy_eV_per_CeO2 equal ${energy_eV}/${nCe}

# Print the results
print "Total energy (kcal/mol) = ${teng};"
print "Number of atoms = ${natoms};"
print "Lattice constant a_0 (Angstroms) = ${a0};"
print "Lattice constant c_0 (Angstroms) = ${c0};"
print "Cohesive energy (eV) = ${ecoh};"
print "Volume = ${v_vol}"
print "Energy (eV) = ${energy_eV}"
print "Energy per Ceriumoxide atom (eV) = ${energy_eV_per_CeO2}"
print "All done!"